<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <meta charset="UTF-8">
  <title th:text="${model.currentClient.title}"></title>
</head>
<body class="text-bg-dark">
<header>
  <nav class="navbar bg-body-dark">
    <a href="/" class="navbar-brand fs-2 text-white h1 mx-2">Review Spot</a>
    <ul class="nav justify-content-end ">
      <li class="nav-item">
        <img th:src="${model.currentClient.clientPhotoUrl}" alt="clientPhoto" width="48" height="48" class="rounded-circle">
      </li>
      <li class="nav-item">
        <a class="nav-link text-white" th:text="${model.currentClient.clientName}" th:href="@{/client/{id}(id=${model.currentClient.clientId})}">Link</a>
      </li>
    </ul>
  </nav>
</header>

<section class="mt-5">
  <div class="container">
    <div class="row">

      <div class="col-2">
        <div class="ratio ratio-1x1">
          <img th:src="${model.clientCard.clientPhotoUrl}" alt="Image" class="img-fluid object-fit-cover">
        </div>
      </div>


      <div class="col-8">
        <p class="h1" th:text="${model.clientCard.clientName}">Name</p>
        <p class="mb-3" th:text="'Количество отзывов: ' + ${model.clientCard.reviewCount}"></p>
        <p class="mb-3" th:text="'Количество комментариев: ' + ${model.clientCard.commentCount}"></p>
      </div>

    </div>
  </div>

</section>

<section class="mt-5" th:if="${not #lists.isEmpty(model.lastReviews)}">
  <div class="container">
    <div class="row justify-content-center mt-3">
      <div class="col-6">
        <h4 class="text-center">Отзывы пользователя</h4>

        <div class="card mx-auto mt-3" th:each="review : ${model.lastReviews}" style="width: 18rem;">
          <div class="row">
            <div class="col-12 text-center">
              <a th:href="@{/media/{id}(id=${review.mediaId})}">
                <img th:src="${review.mediaPhotoUrl}" class="card-img-top mx-auto d-block" style="width: 100px;" alt="Media Photo">
              </a>
              <a class="mt-2 h5" th:text="${review.rating}" th:href="@{/review/{id}(id=${review.reviewId})}"></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <form th:action="@{/client/{id}(id=${model.clientCard.clientId})}" method="get">
    <input type="hidden" name="commentFilter.page" th:value="${commentFilter.page}" />
    <input type="hidden" name="commentFilter.size" th:value="${commentFilter.size}" />

    <nav aria-label="Reviews pagination" th:if="${not #lists.isEmpty(model.lastReviews)}" class="mt-3">
      <ul class="pagination pagination-sm justify-content-center">
        <li class="page-item" th:classappend="${model.lastReviews[0].currentPage == 1} ? 'disabled'">
          <button type="submit" class="page-link" name="reviewFilter.page" th:value="${model.lastReviews[0].currentPage - 1}">
            Previous
          </button>
        </li>

        <li class="page-item"
            th:each="pageNumber : ${#numbers.sequence(1, model.lastReviews[0].totalPages)}"
            th:classappend="${pageNumber == model.lastReviews[0].currentPage} ? 'active'">
          <button type="submit" class="page-link" name="reviewFilter.page" th:value="${pageNumber}" th:text="${pageNumber}">
            1
          </button>
        </li>

        <li class="page-item" th:classappend="${model.lastReviews[0].currentPage == model.lastReviews[0].totalPages} ? 'disabled'">
          <button type="submit" class="page-link" name="reviewFilter.page" th:value="${model.lastReviews[0].currentPage + 1}">
            Next
          </button>
        </li>
      </ul>
    </nav>
  </form>

</section>

<section class="mt-5" th:if="${not #lists.isEmpty(model.lastComments)}">
  <div class="container">
    <div class="row justify-content-center mt-3">
      <div class="col-12">
        <h4 class="text-center">Последние комментарии</h4>

        <div th:if="${error}" class="alert alert-danger w-25 mx-auto">
          <p th:text="${error}"></p>
        </div>

        <div class="card mx-auto mt-3" th:each="comment : ${model.lastComments}">
          <div class="row">

            <div class="col-2 text-center">
              <div class="mb-3">
                <p class="mb-1" th:text="'Лайков: ' + ${comment.likeCount}"></p>
                <p class="mb-0" th:text="'Дизлайков: ' + ${comment.dislikeCount}"></p>
              </div>

              <a th:href="@{/client/{id}(id=${comment.clientId})}">
                <div class="ratio ratio-1x1">
                  <img th:src="${comment.clientPhotoUrl}" class="img-fluid object-fit-cover" alt="Client Photo">
                </div>
              </a>

            </div>

            <div class="col-1 text-center mt-5">
              <h5 class="card-title" th:text="${comment.clientName}"></h5>
              <p class="card-title mt-0" th:text="${comment.mediaName}"></p>

            </div>
            <div class="col-8 d-flex align-items-center text-center">
              <p class="card-text mx-5" th:text="${comment.text}"></p>
            </div>

            <div class="col-1 text-center d-flex align-items-center">
              <div th:if="${comment.isLike}">
                <form action="/reaction/delete" method="post">
                  <input type="hidden" name="clientId" th:value="${model.currentClient.clientId}">
                  <input type="hidden" name="targetId" th:value="${comment.commentId}">
                  <input type="hidden" name="targetType" value="COMMENT">
                  <input type="hidden" name="like" value="true">
                  <input type="hidden" name="currentUrl" th:value="'/client/' + ${model.clientCard.clientId}">
                  <button type="submit" class="btn btn-primary active" aria-pressed="true">Like</button>
                </form>

                <form action="/reaction" method="post">
                  <input type="hidden" name="clientId" th:value="${model.currentClient.clientId}">
                  <input type="hidden" name="targetId" th:value="${comment.commentId}">
                  <input type="hidden" name="targetType" value="COMMENT">
                  <input type="hidden" name="like" value="false">
                  <input type="hidden" name="currentUrl" th:value="'/client/' + ${model.clientCard.clientId}">
                  <button type="submit" class="btn btn-primary">Dislike</button>
                </form>
              </div>
              <div th:if="${comment.isDislike}">
                <form action="/reaction" method="post">
                  <input type="hidden" name="clientId" th:value="${model.currentClient.clientId}">
                  <input type="hidden" name="targetId" th:value="${comment.commentId}">
                  <input type="hidden" name="targetType" value="COMMENT">
                  <input type="hidden" name="like" value="true">
                  <input type="hidden" name="currentUrl" th:value="'/client/' + ${model.clientCard.clientId}">
                  <button type="submit" class="btn btn-primary">Like</button>
                </form>

                <form action="/reaction/delete" method="post">
                  <input type="hidden" name="clientId" th:value="${model.currentClient.clientId}">
                  <input type="hidden" name="targetId" th:value="${comment.commentId}">
                  <input type="hidden" name="targetType" value="COMMENT">
                  <input type="hidden" name="like" value="false">
                  <input type="hidden" name="currentUrl" th:value="'/client/' + ${model.clientCard.clientId}">
                  <button type="submit" class="btn btn-primary active" aria-pressed="true">Dislike</button>
                </form>
              </div>

              <div th:if="${not comment.isLike and not comment.isDislike}">
                <form action="/reaction" method="post">
                  <input type="hidden" name="clientId" th:value="${model.currentClient.clientId}">
                  <input type="hidden" name="targetId" th:value="${comment.commentId}">
                  <input type="hidden" name="targetType" value="COMMENT">
                  <input type="hidden" name="like" value="true">
                  <input type="hidden" name="currentUrl" th:value="'/client/' + ${model.clientCard.clientId}">
                  <button type="submit" class="btn btn-primary">Like</button>
                </form>

                <form action="/reaction" method="post">
                  <input type="hidden" name="clientId" th:value="${model.currentClient.clientId}">
                  <input type="hidden" name="targetId" th:value="${comment.commentId}">
                  <input type="hidden" name="targetType" value="COMMENT">
                  <input type="hidden" name="like" value="false">
                  <input type="hidden" name="currentUrl" th:value="'/client/' + ${model.clientCard.clientId}">
                  <button type="submit" class="btn btn-primary">Dislike</button>
                </form>

              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <form th:action="@{/client/{id}(id=${model.clientCard.clientId})}" method="get">
    <input type="hidden" name="reviewFilter.page" th:value="${reviewFilter.page}" />
    <input type="hidden" name="reviewFilter.size" th:value="${reviewFilter.size}" />

    <nav aria-label="Comments pagination" th:if="${not #lists.isEmpty(model.lastComments)}" class="mt-3">
      <ul class="pagination pagination-sm justify-content-center">
        <li class="page-item" th:classappend="${model.lastComments[0].currentPage == 1} ? 'disabled'">
          <button type="submit" class="page-link" name="commentFilter.page" th:value="${model.lastComments[0].currentPage - 1}">
            Previous
          </button>
        </li>

        <li class="page-item"
            th:each="pageNumber : ${#numbers.sequence(1, model.lastComments[0].totalPages)}"
            th:classappend="${pageNumber == model.lastComments[0].currentPage} ? 'active'">
          <button type="submit" class="page-link" name="commentFilter.page" th:value="${pageNumber}" th:text="${pageNumber}">
            1
          </button>
        </li>

        <li class="page-item" th:classappend="${model.lastComments[0].currentPage == model.lastComments[0].totalPages} ? 'disabled'">
          <button type="submit" class="page-link" name="commentFilter.page" th:value="${model.lastComments[0].currentPage + 1}">
            Next
          </button>
        </li>
      </ul>
    </nav>
  </form>

</section>



</body>
</html>